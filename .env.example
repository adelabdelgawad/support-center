# =============================================================================
# SUPPORT CENTER - COMPREHENSIVE ENVIRONMENT CONFIGURATION
# =============================================================================
# Copy this file to .env and update with your actual values
# This template consolidates all environment variables for all services
#
# SECURITY NOTES:
# ⚠️  NEVER commit the actual .env file with real secrets to git
# ⚠️  Use strong, random passwords for production (min 32 chars recommended)
# ⚠️  Rotate secrets periodically
# ⚠️  Keep this file backed up in a secure location
# ⚠️  Use different secrets for development, staging, and production
#
# Generate secure secrets using:
#   openssl rand -hex 32
# =============================================================================


# =============================================================================
# SHARED SECRETS - Critical security credentials used by multiple services
# =============================================================================
# These variables are referenced across multiple service configurations

# PostgreSQL Database (used by postgres container and backend)
POSTGRES_DB=servicecatalog
POSTGRES_USER=servicecatalog
POSTGRES_PASSWORD=CHANGE_ME_POSTGRES_PASSWORD

# PgBouncer Connection Pooler (should match PostgreSQL credentials)
PGBOUNCER_DB_NAME=servicecatalog
PGBOUNCER_DB_USER=servicecatalog
PGBOUNCER_DB_PASSWORD=CHANGE_ME_POSTGRES_PASSWORD

# Redis (used by redis container, backend, celery, and signalr)
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD

# MinIO Object Storage (used by minio container and backend)
MINIO_ROOT_USER=CHANGE_ME_MINIO_USERNAME
MINIO_ROOT_PASSWORD=CHANGE_ME_MINIO_PASSWORD

# JWT Authentication (shared between backend, frontend, and SignalR)
# CRITICAL: Use a strong, random secret (min 32 chars) for production
JWT_SECRET_KEY=CHANGE_ME_JWT_SECRET_KEY_MIN_32_CHARS

# Session Management (shared between backend and frontend)
SESSION_SECRET=CHANGE_ME_SESSION_SECRET_MIN_32_CHARS

# TURN Server (used by coturn and backend for WebRTC)
TURN_SECRET=CHANGE_ME_TURN_SECRET_MIN_32_CHARS

# SignalR Internal API (used by backend and signalr-service)
SIGNALR_INTERNAL_API_KEY=CHANGE_ME_SIGNALR_API_KEY


# =============================================================================
# DOCKER COMPOSE PORT OVERRIDES
# =============================================================================
# Uncomment to change default ports for services

# Infrastructure Ports
# POSTGRES_PORT=5433              # PostgreSQL (default: 5433, container: 5432)
# PGBOUNCER_PORT=6432             # PgBouncer connection pooler (default: 6432)
# REDIS_PORT=6380                 # Redis cache (default: 6380, container: 6379)

# Application Ports
# BACKEND_PORT_1=8000             # Backend instance 1 (default: 8000)
# BACKEND_PORT_2=8001             # Backend instance 2 (default: 8001)
# BACKEND_PORT_3=8002             # Backend instance 3 (default: 8002)
# FRONTEND_PORT=3010              # Next.js frontend (default: 3010)
# SIGNALR_PORT=5000               # SignalR real-time service (default: 5000)

# Monitoring Ports
# PROMETHEUS_PORT=9090            # Prometheus metrics (default: 9090)
# GRAFANA_PORT=3030               # Grafana dashboards (default: 3030)


# =============================================================================
# DATABASE CONFIGURATION (Backend)
# =============================================================================
# Connection string uses Docker internal networking (postgres:5432)
# For local development, use localhost:5433
DATABASE_URL=postgresql+asyncpg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}
DATABASE_POOL_SIZE=20             # Connection pool size per backend instance
DATABASE_MAX_OVERFLOW=10          # Maximum overflow connections
DATABASE_POOL_TIMEOUT=30          # Connection timeout in seconds
DATABASE_POOL_RECYCLE=3600        # Recycle connections after 1 hour


# =============================================================================
# REDIS CONFIGURATION (Backend + Celery)
# =============================================================================
# Connection string uses Docker internal networking (redis:6379)
# For local development, use localhost:6380
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
REDIS_MAX_CONNECTIONS=50          # Maximum Redis connections per instance


# =============================================================================
# SECURITY & AUTHENTICATION
# =============================================================================
SECURITY_SECRET_KEY=${SESSION_SECRET}
# JWT_SECRET_KEY is already defined in SHARED SECRETS section above
ALGORITHM=HS256                   # JWT algorithm (HS256, HS512, RS256, etc.)
JWT_ISSUER=service-catalog        # JWT issuer claim
JWT_AUDIENCE=it-service-catalog   # JWT audience claim
ACCESS_TOKEN_EXPIRE_MINUTES=15    # Access token expiry (15 minutes)
REFRESH_TOKEN_EXPIRE_DAYS=7       # Refresh token expiry (7 days)


# =============================================================================
# APPLICATION SETTINGS
# =============================================================================
API_APP_NAME=Service Catalog
API_APP_VERSION=1.0.0
API_DEBUG=false                   # Set to true for development (enables debug middleware)
API_API_V1_PREFIX=/api/v1         # API route prefix


# =============================================================================
# CORS (Cross-Origin Resource Sharing)
# =============================================================================
# Comma-separated list of allowed origins (JSON array format)
CORS_ORIGINS=["http://localhost:3010","http://tauri.localhost","tauri://localhost"]


# =============================================================================
# FILE UPLOAD CONFIGURATION
# =============================================================================
UPLOAD_MAX_UPLOAD_SIZE=52428800   # 50MB in bytes
UPLOAD_UPLOAD_DIR=./uploads       # Upload directory path
UPLOAD_ALLOWED_EXTENSIONS=["jpg","jpeg","png","gif","pdf","doc","docx","txt","log","zip"]


# =============================================================================
# WEBSOCKET CONFIGURATION (Legacy - being replaced by SignalR)
# =============================================================================
WS_HEARTBEAT_INTERVAL=30          # Heartbeat interval in seconds
WS_MESSAGE_QUEUE_SIZE=1000        # Maximum queued messages
WS_USE_REDIS_PUBSUB=true          # Enable Redis pub/sub for WebSocket


# =============================================================================
# SIGNALR REAL-TIME SERVICE
# =============================================================================
# Internal URL for SignalR service (Docker networking)
SIGNALR_INTERNAL_URL=http://signalr-service:5000
# API key already defined in SHARED SECRETS section above
SIGNALR_ENABLED=true              # Enable SignalR event broadcasting
SIGNALR_ENABLE_REDIS_BACKPLANE=false  # Enable Redis backplane for multi-instance
ASPNETCORE_ENVIRONMENT=Production # SignalR environment (Development, Production)


# =============================================================================
# MINIO OBJECT STORAGE
# =============================================================================
# Connection uses Docker internal networking (minio:9000)
# For local development, use localhost:9000
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=CHANGE_ME_MINIO_ACCESS_KEY
MINIO_SECRET_KEY=CHANGE_ME_MINIO_SECRET_KEY
MINIO_BUCKET_NAME=servicecatalog-files
MINIO_SECURE=false                # Set to true for HTTPS
MINIO_REGION=us-east-1
MINIO_PRESIGNED_URL_EXPIRY_SECONDS=3600     # 1 hour
MINIO_PRESIGNED_URL_EXPIRY_DOWNLOAD=86400   # 24 hours
MINIO_MAX_FILE_SIZE_MB=50


# =============================================================================
# CELERY BACKGROUND WORKERS
# =============================================================================
# Broker and result backend use Docker internal networking
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@redis:6379/1


# =============================================================================
# ACTIVE DIRECTORY / LDAP INTEGRATION (Optional)
# =============================================================================
AD_PATH=dc.example.com            # Domain controller address
AD_DOMAIN_NAME=EXAMPLE            # NetBIOS domain name
AD_PORT=389                       # LDAP port (389 = unencrypted, 636 = LDAPS)
AD_USE_SSL=false                  # Enable LDAPS
AD_LDAP_USERNAME=service_account  # Service account username
AD_LDAP_PASSWORD=CHANGE_ME_AD_PASSWORD
AD_BASE_DN=DC=example,DC=com      # LDAP base DN
AD_DESIRED_OUS=["Users","Staff"]  # Organizational Units to sync (JSON array)


# =============================================================================
# TURN SERVER (WebRTC NAT Traversal) - Optional
# =============================================================================
TURN_ENABLED=true
TURN_REALM=example.com            # TURN realm (your domain)
TURN_URLS=turn:your-server.com:3478,turn:your-server.com:3478?transport=tcp
TURN_USERNAME=servicecatalog
TURN_CREDENTIAL=CHANGE_ME_TURN_CREDENTIAL
# TURN_SECRET is already defined in SHARED SECRETS section above
TURN_TTL=86400                    # Credential TTL (24 hours)

# CoTURN Network Configuration (for docker-compose)
TURN_LISTENING_IP=0.0.0.0         # Local IP to listen on
TURN_RELAY_IP=0.0.0.0             # IP for relaying media
TURN_EXTERNAL_IP=                 # Public IP / NAT mapping (format: external/internal)


# =============================================================================
# FRONTEND (Next.js) CONFIGURATION
# =============================================================================
# Server-side API URL (uses Docker internal networking)
# For local development, use http://localhost:8000
NEXT_PUBLIC_API_URL=http://backend-1:8000
NEXT_PUBLIC_API_BASE_PATH=/api/v1
NEXT_PUBLIC_SIGNALR_URL=http://signalr-service:5000/hubs

# Frontend-specific settings
ALLOWED_DEV_ORIGINS=localhost,backend


# =============================================================================
# PERFORMANCE & MONITORING
# =============================================================================
PERFORMANCE_QUERY_CACHE_SIZE=1000
PERFORMANCE_ENABLE_QUERY_LOGGING=false  # Set to true to log all SQL queries

MONITORING_ENABLE_METRICS=true
MONITORING_METRICS_PORT=9090


# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_LEVEL=INFO                    # Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_ENABLE_FILE_LOGGING=true      # Enable file logging
LOG_LOG_DIR=logs                  # Log directory
LOG_ENABLE_CONSOLE_LOGGING=true   # Enable console logging
LOG_ENABLE_RAW_REQUEST_LOGGING=false     # VERY verbose - only for debugging
LOG_ENABLE_REQUEST_DEBUG=false    # Enable request debug middleware


# =============================================================================
# GRAFANA MONITORING (Optional)
# =============================================================================
GRAFANA_ADMIN_USER=grafana_admin
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD


# =============================================================================
# ZAPIER / WHATSAPP INTEGRATION (Optional)
# =============================================================================
ZAPIER_BASE_URL=https://hooks.zapier.com/hooks/catch/YOUR_HOOK_ID/
ZAPIER_SEND_TYPE=Group            # Group or Individual
FRONTEND_BASE_URL=http://localhost:3010


# =============================================================================
# ADMIN USER SETUP (First-time deployment only)
# =============================================================================
# IMPORTANT: Change these credentials immediately after first deployment
# These are used to create the initial admin user on first startup
ADMIN_USERNAME=admin
ADMIN_PASSWORD=CHANGE_ME_ADMIN_PASSWORD
ADMIN_EMAIL=admin@example.com
ADMIN_FULL_NAME=System Administrator


# =============================================================================
# POSTGRES INITIALIZATION (For docker-compose postgres service)
# =============================================================================
POSTGRES_INITDB_ARGS=-E UTF8 --locale=en_US.UTF-8


# =============================================================================
# REAL-TIME EVENT TRANSPORT (Feature 001)
# =============================================================================
# Redis Streams configuration for low-latency event delivery
EVENT_TRANSPORT_USE_REDIS_STREAMS=false     # Enable Redis Streams transport
EVENT_TRANSPORT_REDIS_PERCENTAGE=0          # Traffic percentage for rollout (0-100)
EVENT_TRANSPORT_FALLBACK_TO_HTTP=true       # HTTP fallback on failure
EVENT_TRANSPORT_STREAM_MAX_LEN=10000        # Max stream length
EVENT_TRANSPORT_CONSUMER_GROUP=signalr-consumers  # Consumer group name


# =============================================================================
# END OF CONFIGURATION
# =============================================================================
# After updating this file:
# 1. Copy service-specific env files from docker/env/.env.example.*
# 2. Update service-specific settings in docker/env/.env.*
# 3. Restart services: docker-compose down && docker-compose up -d
# =============================================================================

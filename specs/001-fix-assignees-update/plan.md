# Implementation Plan: Fix Assignees List Update Bug

**Branch**: `001-fix-assignees-update` | **Date**: 2026-01-08 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-fix-assignees-update/spec.md`

## Summary

Fix two bugs in the assignees management feature:
1. **UI State Bug**: When adding a new assignee, the UI incorrectly shows only the new assignee plus one existing, dropping the first assignee until page reload
2. **Notification Bug**: The `ticket_assigned` system notification only triggers on the first assignment, not for subsequent assignees

Root causes identified through research:
- **UI Bug**: Frontend state mutation function replaces instead of appending to the assignees array
- **Notification Bug**: Backend intentionally only triggers notification on first assignment (`is_first_assignment` check)

## Technical Context

**Language/Version**: Python 3.12+ (Backend), TypeScript 5.x (Frontend)
**Primary Dependencies**: FastAPI, SQLModel, Next.js 15, React 19, SWR
**Storage**: PostgreSQL with asyncpg
**Testing**: pytest (backend), manual verification
**Target Platform**: Linux server (backend), Web browser (frontend)
**Project Type**: Web application (frontend + backend)
**Performance Goals**: <5s notification delivery, instant UI update
**Constraints**: Must not break existing notification system for first assignments
**Scale/Scope**: Existing production system, minimal change surface

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. HTTPSchemaModel Inheritance | N/A | No new schemas required - bug fix only |
| II. API Proxy Pattern | PASS | Using existing Next.js API routes, no changes needed |
| III. Bun Package Manager | PASS | Will use `bun` for any frontend commands |
| IV. Service Layer Architecture | PASS | Backend fix in endpoint (notification trigger), not adding business logic |
| V. Clean Code Removal | PASS | No legacy code being introduced |

**Quality Gates**:
- [ ] Frontend fix uses SWR properly for state management
- [ ] Backend fix follows existing notification pattern
- [ ] No new schemas inherit from BaseModel directly

## Project Structure

### Documentation (this feature)

```text
specs/001-fix-assignees-update/
├── plan.md              # This file
├── research.md          # Root cause analysis
├── data-model.md        # Existing entity documentation (no changes)
├── quickstart.md        # Testing steps
└── tasks.md             # Implementation tasks (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
backend/
├── api/v1/endpoints/
│   └── requests.py              # FIX: trigger_ticket_assigned for all new assignees
└── services/
    └── event_trigger_service.py # No changes needed (generic trigger works)

src/it-app/
├── lib/hooks/
│   └── use-request-assignees.ts # FIX: Correct state mutation in addAssignee
└── app/(it-pages)/support-center/requests/(details)/[id]/
    └── _context/
        └── request-detail-context.tsx  # Verify context passes correct data
```

**Structure Decision**: Web application - existing backend/frontend structure maintained. Bug fixes only - no new files.

## Complexity Tracking

> No constitution violations - this is a targeted bug fix with minimal changes.

| Change | Justification |
|--------|---------------|
| Modify endpoint notification logic | Required to fix notification bug - adds trigger for all new assignees |
| Modify SWR hook state mutation | Required to fix UI bug - correct array concatenation |
